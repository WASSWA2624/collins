8ae0b99c48020081efe48a2fec7779a3
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault").default;
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));
var _react = require("react");
var _ = require("./");
var _security = require("../security");
var useBiometricAuth = function useBiometricAuth() {
  var _useI18n = (0, _.useI18n)(),
    t = _useI18n.t;
  var _useState = (0, _react.useState)(false),
    _useState2 = (0, _slicedToArray2.default)(_useState, 2),
    isAvailable = _useState2[0],
    setIsAvailable = _useState2[1];
  var _useState3 = (0, _react.useState)(true),
    _useState4 = (0, _slicedToArray2.default)(_useState3, 2),
    isChecking = _useState4[0],
    setIsChecking = _useState4[1];
  var _useState5 = (0, _react.useState)(null),
    _useState6 = (0, _slicedToArray2.default)(_useState5, 2),
    errorMessage = _useState6[0],
    setErrorMessage = _useState6[1];
  var checkAvailability = (0, _react.useCallback)((0, _asyncToGenerator2.default)(function* () {
    setIsChecking(true);
    var _yield$Promise$all = yield Promise.all([(0, _security.isBiometricSupported)(), (0, _security.isBiometricEnrolled)()]),
      _yield$Promise$all2 = (0, _slicedToArray2.default)(_yield$Promise$all, 2),
      supported = _yield$Promise$all2[0],
      enrolled = _yield$Promise$all2[1];
    setIsAvailable(Boolean(supported && enrolled));
    setIsChecking(false);
  }), []);
  (0, _react.useEffect)(function () {
    var isMounted = true;
    var load = function () {
      var _ref2 = (0, _asyncToGenerator2.default)(function* () {
        var _yield$Promise$all3 = yield Promise.all([(0, _security.isBiometricSupported)(), (0, _security.isBiometricEnrolled)()]),
          _yield$Promise$all4 = (0, _slicedToArray2.default)(_yield$Promise$all3, 2),
          supported = _yield$Promise$all4[0],
          enrolled = _yield$Promise$all4[1];
        if (!isMounted) return;
        setIsAvailable(Boolean(supported && enrolled));
        setIsChecking(false);
      });
      return function load() {
        return _ref2.apply(this, arguments);
      };
    }();
    load();
    return function () {
      isMounted = false;
    };
  }, []);
  var authenticate = (0, _react.useCallback)((0, _asyncToGenerator2.default)(function* () {
    setErrorMessage(null);
    var result = yield (0, _security.authenticateBiometric)({
      promptMessage: t('auth.login.biometric.prompt'),
      cancelLabel: t('auth.login.biometric.cancel'),
      fallbackLabel: t('auth.login.biometric.fallback')
    });
    if (!(result != null && result.success)) {
      setErrorMessage(t('auth.login.biometric.error'));
      return false;
    }
    return true;
  }), [t]);
  return (0, _react.useMemo)(function () {
    return {
      isAvailable: isAvailable,
      isChecking: isChecking,
      errorMessage: errorMessage,
      authenticate: authenticate,
      refreshAvailability: checkAvailability
    };
  }, [authenticate, checkAvailability, errorMessage, isAvailable, isChecking]);
};
var _default = exports.default = useBiometricAuth;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVhY3QiLCJyZXF1aXJlIiwiXyIsIl9zZWN1cml0eSIsInVzZUJpb21ldHJpY0F1dGgiLCJfdXNlSTE4biIsInVzZUkxOG4iLCJ0IiwiX3VzZVN0YXRlIiwidXNlU3RhdGUiLCJfdXNlU3RhdGUyIiwiX3NsaWNlZFRvQXJyYXkyIiwiZGVmYXVsdCIsImlzQXZhaWxhYmxlIiwic2V0SXNBdmFpbGFibGUiLCJfdXNlU3RhdGUzIiwiX3VzZVN0YXRlNCIsImlzQ2hlY2tpbmciLCJzZXRJc0NoZWNraW5nIiwiX3VzZVN0YXRlNSIsIl91c2VTdGF0ZTYiLCJlcnJvck1lc3NhZ2UiLCJzZXRFcnJvck1lc3NhZ2UiLCJjaGVja0F2YWlsYWJpbGl0eSIsInVzZUNhbGxiYWNrIiwiX2FzeW5jVG9HZW5lcmF0b3IyIiwiX3lpZWxkJFByb21pc2UkYWxsIiwiUHJvbWlzZSIsImFsbCIsImlzQmlvbWV0cmljU3VwcG9ydGVkIiwiaXNCaW9tZXRyaWNFbnJvbGxlZCIsIl95aWVsZCRQcm9taXNlJGFsbDIiLCJzdXBwb3J0ZWQiLCJlbnJvbGxlZCIsIkJvb2xlYW4iLCJ1c2VFZmZlY3QiLCJpc01vdW50ZWQiLCJsb2FkIiwiX3JlZjIiLCJfeWllbGQkUHJvbWlzZSRhbGwzIiwiX3lpZWxkJFByb21pc2UkYWxsNCIsImFwcGx5IiwiYXJndW1lbnRzIiwiYXV0aGVudGljYXRlIiwicmVzdWx0IiwiYXV0aGVudGljYXRlQmlvbWV0cmljIiwicHJvbXB0TWVzc2FnZSIsImNhbmNlbExhYmVsIiwiZmFsbGJhY2tMYWJlbCIsInN1Y2Nlc3MiLCJ1c2VNZW1vIiwicmVmcmVzaEF2YWlsYWJpbGl0eSIsIl9kZWZhdWx0IiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbInVzZUJpb21ldHJpY0F1dGguanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIHVzZUJpb21ldHJpY0F1dGggSG9va1xyXG4gKiBFeHBvc2VzIGJpb21ldHJpYyBhdmFpbGFiaWxpdHkgYW5kIGF1dGhlbnRpY2F0aW9uIGhlbHBlcnMuXHJcbiAqIEZpbGU6IHVzZUJpb21ldHJpY0F1dGguanNcclxuICovXHJcbmltcG9ydCB7IHVzZUNhbGxiYWNrLCB1c2VFZmZlY3QsIHVzZU1lbW8sIHVzZVN0YXRlIH0gZnJvbSAncmVhY3QnO1xyXG5pbXBvcnQgeyB1c2VJMThuIH0gZnJvbSAnQGhvb2tzJztcclxuaW1wb3J0IHsgYXV0aGVudGljYXRlQmlvbWV0cmljLCBpc0Jpb21ldHJpY0Vucm9sbGVkLCBpc0Jpb21ldHJpY1N1cHBvcnRlZCB9IGZyb20gJ0BzZWN1cml0eSc7XHJcblxyXG5jb25zdCB1c2VCaW9tZXRyaWNBdXRoID0gKCkgPT4ge1xyXG4gIGNvbnN0IHsgdCB9ID0gdXNlSTE4bigpO1xyXG4gIGNvbnN0IFtpc0F2YWlsYWJsZSwgc2V0SXNBdmFpbGFibGVdID0gdXNlU3RhdGUoZmFsc2UpO1xyXG4gIGNvbnN0IFtpc0NoZWNraW5nLCBzZXRJc0NoZWNraW5nXSA9IHVzZVN0YXRlKHRydWUpO1xyXG4gIGNvbnN0IFtlcnJvck1lc3NhZ2UsIHNldEVycm9yTWVzc2FnZV0gPSB1c2VTdGF0ZShudWxsKTtcclxuXHJcbiAgY29uc3QgY2hlY2tBdmFpbGFiaWxpdHkgPSB1c2VDYWxsYmFjayhhc3luYyAoKSA9PiB7XHJcbiAgICBzZXRJc0NoZWNraW5nKHRydWUpO1xyXG4gICAgY29uc3QgW3N1cHBvcnRlZCwgZW5yb2xsZWRdID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xyXG4gICAgICBpc0Jpb21ldHJpY1N1cHBvcnRlZCgpLFxyXG4gICAgICBpc0Jpb21ldHJpY0Vucm9sbGVkKCksXHJcbiAgICBdKTtcclxuICAgIHNldElzQXZhaWxhYmxlKEJvb2xlYW4oc3VwcG9ydGVkICYmIGVucm9sbGVkKSk7XHJcbiAgICBzZXRJc0NoZWNraW5nKGZhbHNlKTtcclxuICB9LCBbXSk7XHJcblxyXG4gIHVzZUVmZmVjdCgoKSA9PiB7XHJcbiAgICBsZXQgaXNNb3VudGVkID0gdHJ1ZTtcclxuICAgIGNvbnN0IGxvYWQgPSBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IFtzdXBwb3J0ZWQsIGVucm9sbGVkXSA9IGF3YWl0IFByb21pc2UuYWxsKFtcclxuICAgICAgICBpc0Jpb21ldHJpY1N1cHBvcnRlZCgpLFxyXG4gICAgICAgIGlzQmlvbWV0cmljRW5yb2xsZWQoKSxcclxuICAgICAgXSk7XHJcbiAgICAgIGlmICghaXNNb3VudGVkKSByZXR1cm47XHJcbiAgICAgIHNldElzQXZhaWxhYmxlKEJvb2xlYW4oc3VwcG9ydGVkICYmIGVucm9sbGVkKSk7XHJcbiAgICAgIHNldElzQ2hlY2tpbmcoZmFsc2UpO1xyXG4gICAgfTtcclxuICAgIGxvYWQoKTtcclxuICAgIHJldHVybiAoKSA9PiB7XHJcbiAgICAgIGlzTW91bnRlZCA9IGZhbHNlO1xyXG4gICAgfTtcclxuICB9LCBbXSk7XHJcblxyXG4gIGNvbnN0IGF1dGhlbnRpY2F0ZSA9IHVzZUNhbGxiYWNrKGFzeW5jICgpID0+IHtcclxuICAgIHNldEVycm9yTWVzc2FnZShudWxsKTtcclxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGF1dGhlbnRpY2F0ZUJpb21ldHJpYyh7XHJcbiAgICAgIHByb21wdE1lc3NhZ2U6IHQoJ2F1dGgubG9naW4uYmlvbWV0cmljLnByb21wdCcpLFxyXG4gICAgICBjYW5jZWxMYWJlbDogdCgnYXV0aC5sb2dpbi5iaW9tZXRyaWMuY2FuY2VsJyksXHJcbiAgICAgIGZhbGxiYWNrTGFiZWw6IHQoJ2F1dGgubG9naW4uYmlvbWV0cmljLmZhbGxiYWNrJyksXHJcbiAgICB9KTtcclxuICAgIGlmICghcmVzdWx0Py5zdWNjZXNzKSB7XHJcbiAgICAgIHNldEVycm9yTWVzc2FnZSh0KCdhdXRoLmxvZ2luLmJpb21ldHJpYy5lcnJvcicpKTtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRydWU7XHJcbiAgfSwgW3RdKTtcclxuXHJcbiAgcmV0dXJuIHVzZU1lbW8oKCkgPT4gKHtcclxuICAgIGlzQXZhaWxhYmxlLFxyXG4gICAgaXNDaGVja2luZyxcclxuICAgIGVycm9yTWVzc2FnZSxcclxuICAgIGF1dGhlbnRpY2F0ZSxcclxuICAgIHJlZnJlc2hBdmFpbGFiaWxpdHk6IGNoZWNrQXZhaWxhYmlsaXR5LFxyXG4gIH0pLCBbYXV0aGVudGljYXRlLCBjaGVja0F2YWlsYWJpbGl0eSwgZXJyb3JNZXNzYWdlLCBpc0F2YWlsYWJsZSwgaXNDaGVja2luZ10pO1xyXG59O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgdXNlQmlvbWV0cmljQXV0aDtcclxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBS0EsSUFBQUEsTUFBQSxHQUFBQyxPQUFBO0FBQ0EsSUFBQUMsQ0FBQSxHQUFBRCxPQUFBO0FBQ0EsSUFBQUUsU0FBQSxHQUFBRixPQUFBO0FBRUEsSUFBTUcsZ0JBQWdCLEdBQUcsU0FBbkJBLGdCQUFnQkEsQ0FBQSxFQUFTO0VBQzdCLElBQUFDLFFBQUEsR0FBYyxJQUFBQyxTQUFPLEVBQUMsQ0FBQztJQUFmQyxDQUFDLEdBQUFGLFFBQUEsQ0FBREUsQ0FBQztFQUNULElBQUFDLFNBQUEsR0FBc0MsSUFBQUMsZUFBUSxFQUFDLEtBQUssQ0FBQztJQUFBQyxVQUFBLE9BQUFDLGVBQUEsQ0FBQUMsT0FBQSxFQUFBSixTQUFBO0lBQTlDSyxXQUFXLEdBQUFILFVBQUE7SUFBRUksY0FBYyxHQUFBSixVQUFBO0VBQ2xDLElBQUFLLFVBQUEsR0FBb0MsSUFBQU4sZUFBUSxFQUFDLElBQUksQ0FBQztJQUFBTyxVQUFBLE9BQUFMLGVBQUEsQ0FBQUMsT0FBQSxFQUFBRyxVQUFBO0lBQTNDRSxVQUFVLEdBQUFELFVBQUE7SUFBRUUsYUFBYSxHQUFBRixVQUFBO0VBQ2hDLElBQUFHLFVBQUEsR0FBd0MsSUFBQVYsZUFBUSxFQUFDLElBQUksQ0FBQztJQUFBVyxVQUFBLE9BQUFULGVBQUEsQ0FBQUMsT0FBQSxFQUFBTyxVQUFBO0lBQS9DRSxZQUFZLEdBQUFELFVBQUE7SUFBRUUsZUFBZSxHQUFBRixVQUFBO0VBRXBDLElBQU1HLGlC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